<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Galoya Dairy Products</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background: url("images/Galoya.webp") no-repeat center center fixed;
        background-size: cover;
        display: flex;
        color: #333;
        overflow-x: hidden;
      }

      /* Sidebar */
      .sidebar {
        width: 250px;
        height: auto;
        background: linear-gradient(135deg, #108a4d, #0f6e3d);
        color: #fff;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        animation: slideInLeft 1s ease-in-out;
      }

      @keyframes slideInLeft {
        from {
          transform: translateX(-100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .sidebar h2 {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 30px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
      }

      .sidebar button {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        border: none;
        background: rgba(255, 255, 255, 0.2);
        color: #fff;
        font-size: 16px;
        font-weight: 500;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .sidebar button:hover {
        background: linear-gradient(90deg, #5e72e4, #4a5bbf);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(94, 114, 228, 0.3);
        color: #fff;
      }

      /* Main Content */
      .main {
        flex: 1;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        border-radius: 15px 0 0 15px;
        min-height: 100vh;
      }

      .dashboard-container,
      .orders-container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .order-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(5px);
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 280px;
        text-align: center;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: fadeIn 0.5s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .order-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      }

      .order-card h3 {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #2c3e50;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }

      .order-card p {
        font-size: 24px;
        font-weight: 700;
        color: #5e72e4;
        margin: 0;
        text-shadow: 1px 1px 2px rgba(94, 114, 228, 0.2);
      }

      .recent-orders-container {
        margin-top: 30px;
      }

      .recent-orders-container h3 {
        font-size: 24px;
        font-weight: 700;
        color: #2c3e50;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .order-card-recent {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(5px);
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .order-card-recent:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
      }

      .order-card-recent p {
        font-size: 16px;
        color: #4a5568;
        margin: 5px 0;
      }

      #completedOrdersList {
        display: none;
        margin-top: 30px;
      }

      #completedOrdersList h3 {
        font-size: 24px;
        font-weight: 700;
        color: #2c3e50;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .sidebar {
          width: 200px;
        }
        .sidebar h2 {
          font-size: 20px;
        }
        .sidebar button {
          font-size: 14px;
          padding: 10px;
        }
        .main {
          padding: 10px;
        }
        .order-card {
          min-width: 100%;
        }
        .order-card-recent {
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h2><i class="bx bx-chart"></i> Sales Dashboard</h2>
      <button onclick="window.location.href='view-order.html'">
        View Orders
      </button>
      <button onclick="window.location.href='report.html'">
        Generate Report
      </button>
      <button onclick="window.location.href='updatePrice.html'">
        Update Price
      </button>
      <button onclick="window.location.href='chart.html'">
        Generate Charts
      </button>
      <button onclick="window.location.href='orderStatus.html'">
        Generate Status
      </button>
      <button onclick="window.location.href='orderVolume.html'">
        Order Volume
      </button>
    </div>

    <!-- Main Content -->
    <div class="main">
      <div id="contentArea">
        <div class="orders-container">
          <!-- Total Orders -->
          <div class="order-card" id="totalOrdersCard">
            <h3>Total Orders</h3>
            <p id="totalOrders">0</p>
          </div>
          <!-- Completed Orders -->
          <div class="order-card" id="completedOrdersCard">
            <h3>Completed Orders</h3>
            <p id="completedOrders">0</p>
          </div>
        </div>
        <div class="recent-orders-container">
          <h3>Recent Orders</h3>
          <div id="recentOrders"></div>
        </div>
        <!-- Completed Orders List (Initially Hidden) -->
        <div id="completedOrdersList">
          <h3>Completed Orders Details</h3>
          <div id="completedOrdersDetails"></div>
        </div>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDhThO6iR48f6loaQU40yCiA1IGInq_ZZk",
        authDomain: "galoya-web-app.firebaseapp.com",
        projectId: "galoya-web-app",
        storageBucket: "gs://galoya-web-app.appspot.com",
        messagingSenderId: "272214790341",
        appId: "1:272214790341:web:4b7238b47d601a378da0ac",
        measurementId: "G-322L3R40GC",
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      async function fetchOrders() {
        try {
          const querySnapshot = await getDocs(collection(db, "orders"));
          return querySnapshot.docs.map((doc) => ({
            id: doc.id,
            ...doc.data(),
          }));
        } catch (error) {
          console.error("Error fetching orders:", error.message, error.code);
          return [];
        }
      }

      async function showDashboard() {
        const orders = await fetchOrders();
        const totalOrders = orders.length;
        const completedOrders = orders.filter(
          (order) => order.status === "completed"
        ).length;

        document.getElementById("totalOrders").textContent = totalOrders;
        document.getElementById("completedOrders").textContent =
          completedOrders;

        // Show recent orders (last 5)
        const recentOrders = orders
          .slice(-5)
          .map(
            (order) => `
                <div class="order-card-recent">
                    <p>Order ID: ${order.id}</p>
                    <p>Amount: Rs. ${order.totalAmount || 0}</p>
                    <p>Date: ${
                      order.timestamp
                        ? new Date(
                            order.timestamp.seconds * 1000
                          ).toLocaleDateString()
                        : "N/A"
                    }</p>
                </div>
            `
          )
          .join("");
        document.getElementById("recentOrders").innerHTML =
          recentOrders || "<p>No recent orders.</p>";
      }

      async function showCompletedOrders() {
        const orders = await fetchOrders();
        const completedOrders = orders.filter(
          (order) => order.status === "completed"
        );

        const completedOrdersDetails = completedOrders
          .map(
            (order) => `
                <div class="order-card-recent">
                    <p>Order ID: ${order.id}</p>
                    <p>Amount: Rs. ${order.totalAmount || 0}</p>
                    <p>Date: ${
                      order.timestamp
                        ? new Date(
                            order.timestamp.seconds * 1000
                          ).toLocaleDateString()
                        : "N/A"
                    }</p>
                </div>
            `
          )
          .join("");
        document.getElementById("completedOrdersDetails").innerHTML =
          completedOrdersDetails || "<p>No completed orders.</p>";
      }

      document
        .getElementById("completedOrdersCard")
        .addEventListener("click", async () => {
          const completedOrdersList = document.getElementById(
            "completedOrdersList"
          );
          if (completedOrdersList.style.display === "block") {
            completedOrdersList.style.display = "none";
          } else {
            await showCompletedOrders();
            completedOrdersList.style.display = "block";
          }
        });

      // Initial dashboard load
      showDashboard();
    </script>
  </body>
</html>
